{% extends 'base.html' %}

{% block content %}
<div class="min-h-screen py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-10">
            <div>
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
                    Offres de <span class="gradient-text">Stage</span>
                </h1>
                <p class="text-lg text-gray-600">D√©couvrez les meilleures opportunit√©s en Guyane</p>
            </div>

            {% if user.is_authenticated and user.user_type == 'company' %}
            <a href="{% url 'internship_create' %}"
                class="mt-4 md:mt-0 inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-bold rounded-xl shadow-medium hover:shadow-strong transition-all transform hover:-translate-y-1">
                <span class="text-xl mr-2">+</span> Publier une offre
            </a>
            {% endif %}
        </div>

        <!-- Search & Filters -->
        <div class="glass rounded-2xl p-6 mb-8 shadow-medium border border-blue-100">
            <form method="GET" action="{% url 'internship_list' %}" id="search-form">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <!-- Search -->
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Rechercher</label>
                        <div class="relative">
                            <input type="text" name="q" value="{{ request.GET.q }}"
                                placeholder="Titre, entreprise, mots-cl√©s..."
                                class="w-full bg-white border border-gray-300 rounded-xl px-4 py-3 pl-11 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all shadow-soft">
                            <span class="absolute left-4 top-3.5 text-gray-400 text-lg" aria-hidden="true">üîç</span>
                        </div>
                    </div>

                    <!-- Location -->
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Localisation</label>
                        <select name="location"
                            class="w-full bg-white border border-gray-300 rounded-xl px-4 py-3 text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all shadow-soft">
                            <option value="">Toutes</option>
                            <option value="Cayenne" {% if request.GET.location == "Cayenne" %}selected{% endif %}>üìç Cayenne</option>
                            <option value="Kourou" {% if request.GET.location == "Kourou" %}selected{% endif %}>üìç Kourou</option>
                            <option value="Saint-Laurent" {% if request.GET.location == "Saint-Laurent" %}selected{% endif %}>üìç Saint-Laurent</option>
                            <option value="R√©mire-Montjoly" {% if request.GET.location == "R√©mire-Montjoly" %}selected{% endif %}>üìç R√©mire-Montjoly</option>
                            <option value="Matoury" {% if request.GET.location == "Matoury" %}selected{% endif %}>üìç Matoury</option>
                        </select>
                    </div>

                    <!-- Duration -->
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Dur√©e</label>
                        <select name="duration"
                            class="w-full bg-white border border-gray-300 rounded-xl px-4 py-3 text-gray-900 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all shadow-soft">
                            <option value="">Toutes</option>
                            <option value="1" {% if request.GET.duration == "1" %}selected{% endif %}>‚è± 1-2 mois</option>
                            <option value="3" {% if request.GET.duration == "3" %}selected{% endif %}>‚è± 3-4 mois</option>
                            <option value="5" {% if request.GET.duration == "5" %}selected{% endif %}>‚è± 5-6 mois</option>
                        </select>
                    </div>
                </div>

                <div class="flex flex-wrap gap-4 items-center justify-between">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" name="paid" value="1" {% if request.GET.paid %}checked{% endif %}
                            class="w-5 h-5 text-primary-600 bg-white border-gray-300 rounded focus:ring-primary-500">
                        <span class="text-gray-700 text-sm font-medium">üí∞ Stages r√©mun√©r√©s uniquement</span>
                    </label>

                    <div class="flex gap-2">
                        <a href="{% url 'internship_list' %}"
                            class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-lg transition-all">
                            Effacer
                        </a>
                        <button type="submit"
                            class="px-6 py-2 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-semibold rounded-lg transition-all shadow-medium flex items-center gap-2">
                            <span>üîç</span> Rechercher
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Results Info -->
        <div class="flex justify-between items-center mb-6">
            <p class="text-gray-600">
                <span class="text-gray-900 font-bold">{{ internships|length }}</span> offre(s) trouv√©e(s)
                {% if request.GET.q %} pour "<span class="text-primary-600 font-semibold">{{ request.GET.q }}</span>"{% endif %}
            </p>
            <select id="sort-select" onchange="updateSort(this.value)"
                class="bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 shadow-soft">
                <option value="-created_at" {% if request.GET.sort == "-created_at" or not request.GET.sort %}selected{% endif %}>Plus r√©cent</option>
                <option value="created_at" {% if request.GET.sort == "created_at" %}selected{% endif %}>Plus ancien</option>
                <option value="title" {% if request.GET.sort == "title" %}selected{% endif %}>Alphab√©tique</option>
            </select>
        </div>

        {% if internships %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="internships-grid">
            {% for internship in internships %}
            <div class="glass rounded-2xl overflow-hidden hover:shadow-strong transition-all duration-300 flex flex-col group border border-blue-100 hover:border-primary-300">
                <div class="p-6 flex-grow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-14 h-14 bg-gradient-to-br from-primary-100 to-blue-100 rounded-xl flex items-center justify-center group-hover:scale-110 transition-all">
                            <img src="https://ui-avatars.com/api/?name={{ internship.company.username }}&background=2563eb&color=fff&bold=true"
                                class="w-12 h-12 rounded-lg" alt="{{ internship.company.username }}">
                        </div>
                        {% if internship.is_new %}
                        <span class="bg-gradient-to-r from-accent-500 to-accent-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide shadow-md">Nouveau</span>
                        {% endif %}
                    </div>

                    <h3 class="text-xl font-bold text-gray-900 mb-2 leading-tight group-hover:text-primary-600 transition">{{ internship.title }}</h3>
                    <p class="text-primary-600 font-semibold text-sm mb-4">{{ internship.company.username }}</p>

                    <div class="space-y-2 text-sm text-gray-600">
                        <div class="flex items-center">
                            <span class="mr-2" aria-hidden="true">üìç</span> {{ internship.location }}
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2" aria-hidden="true">‚è±</span> {{ internship.duration }}
                        </div>
                        {% if internship.salary %}
                        <div class="flex items-center text-accent-600 font-semibold">
                            <span class="mr-2" aria-hidden="true">üí∞</span> {{ internship.salary }}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-4 flex justify-between items-center border-t border-blue-100 group-hover:from-primary-50 group-hover:to-blue-50 transition-all">
                    <span class="text-xs text-gray-500 font-medium">{{ internship.created_at|timesince }}</span>
                    <a href="{% url 'internship_detail' internship.slug %}"
                        class="text-white font-bold text-sm bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 py-2 px-4 rounded-lg transition-all shadow-medium">
                        Voir l'offre
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>

        {% else %}
        <div class="glass rounded-2xl p-12 text-center border border-blue-100 shadow-medium">
            <div class="w-20 h-20 bg-gradient-to-br from-gray-100 to-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-4xl" aria-hidden="true">üîç</span>
            </div>
            <p class="text-2xl text-gray-900 font-bold mb-2">Aucune offre trouv√©e</p>
            <p class="text-gray-600 mb-6">Essayez de modifier vos crit√®res de recherche</p>
            {% if request.GET.q or request.GET.location or request.GET.duration %}
            <a href="{% url 'internship_list' %}"
                class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-bold rounded-xl shadow-medium hover:shadow-strong transition-all">
                Effacer les filtres
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<script>
    function updateSort(value) {
        const url = new URL(window.location.href);
        url.searchParams.set('sort', value);
        window.location.href = url.toString();
    }
</script>
{% endblock %}
