{% extends 'base.html' %}

{% block content %}
<div class="min-h-screen py-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Back Button -->
        <a href="{% url 'housing_list' %}" 
           class="inline-flex items-center text-primary-600 hover:text-primary-700 font-semibold mb-6 transition-all">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Retour aux offres
        </a>

        <div class="glass rounded-2xl overflow-hidden shadow-strong border border-blue-100">
            
            <!-- Image -->
            <div class="h-96 bg-gradient-to-br from-gray-100 to-blue-100 relative overflow-hidden">
                {% if offer.images %}
                <img src="{{ offer.images.url }}"
                    class="w-full h-full object-cover" alt="{{ offer.title }}">
                {% else %}
                <div class="w-full h-full flex items-center justify-center text-gray-400">
                    <svg class="w-32 h-32" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                        </path>
                    </svg>
                </div>
                {% endif %}
                <span class="absolute top-6 right-6 bg-white/90 backdrop-blur-sm text-gray-900 text-sm font-bold px-4 py-2 rounded-xl shadow-medium">
                    {{ offer.get_housing_type_display }}
                </span>
            </div>

            <!-- Content -->
            <div class="p-8">
                
                <!-- Header -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 pb-6 border-b border-blue-100">
                    <div class="mb-4 md:mb-0">
                        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-3">
                            {{ offer.title }}
                        </h1>
                        <p class="text-gray-600 flex items-center text-lg">
                            <span class="mr-2" aria-hidden="true">üìç</span> {{ offer.location }}
                        </p>
                    </div>
                    <div class="text-right">
                        <div class="text-4xl font-extrabold text-primary-600 mb-1">
                            {{ offer.price }} ‚Ç¨
                        </div>
                        <div class="text-sm text-gray-600">par mois</div>
                    </div>
                </div>

                <!-- Description -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                        <span class="mr-2" aria-hidden="true">üìù</span> Description
                    </h2>
                    <div class="text-gray-700 leading-relaxed whitespace-pre-line bg-gray-50 rounded-xl p-6">
                        {{ offer.description }}
                    </div>
                </div>

                <!-- Details -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-50 to-primary-50 rounded-xl p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <span class="mr-2" aria-hidden="true">‚ÑπÔ∏è</span> Informations
                        </h3>
                        <div class="space-y-3 text-gray-700">
                            <div class="flex items-center">
                                <span class="font-semibold w-32">Type :</span>
                                <span>{{ offer.get_housing_type_display }}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="font-semibold w-32">Localisation :</span>
                                <span>{{ offer.location }}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="font-semibold w-32">Prix :</span>
                                <span class="text-primary-600 font-bold">{{ offer.price }} ‚Ç¨/mois</span>
                            </div>
                            <div class="flex items-center">
                                <span class="font-semibold w-32">Publi√© le :</span>
                                <span>{{ offer.created_at|date:"d/m/Y" }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-primary-50 to-blue-50 rounded-xl p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <span class="mr-2" aria-hidden="true">üìû</span> Contact
                        </h3>
                        <div class="space-y-3 text-gray-700">
                            {% if offer.owner %}
                            <div class="flex items-center">
                                <span class="font-semibold w-32">Propri√©taire :</span>
                                <span>{{ offer.owner.get_display_name }}</span>
                            </div>
                            {% endif %}
                            <div class="flex items-center">
                                <span class="font-semibold w-32">Email :</span>
                                <a href="mailto:{{ offer.contact_email }}" class="text-primary-600 hover:text-primary-700 font-semibold">
                                    {{ offer.contact_email }}
                                </a>
                            </div>
                            {% if offer.contact_phone %}
                            <div class="flex items-center">
                                <span class="font-semibold w-32">T√©l√©phone :</span>
                                <a href="tel:{{ offer.contact_phone }}" class="text-primary-600 hover:text-primary-700 font-semibold">
                                    {{ offer.contact_phone }}
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Contact Form / Application -->
                {% if user.is_authenticated %}
                    {% if has_applied %}
                    <div class="bg-green-50 border-2 border-green-300 rounded-xl p-6 text-center">
                        <svg class="w-16 h-16 text-green-600 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Candidature envoy√©e</h3>
                        <p class="text-gray-600">Vous avez d√©j√† postul√© pour ce logement. Le propri√©taire vous contactera bient√¥t.</p>
                    </div>
                    {% else %}
                    <div class="bg-gradient-to-br from-blue-50 to-primary-50 rounded-xl p-6 border-2 border-primary-200">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="mr-2" aria-hidden="true">üìù</span> Postuler pour ce logement
                        </h3>
                        <form method="post" class="space-y-4">
                            {% csrf_token %}
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Votre message *</label>
                                <textarea name="message" rows="4" required
                                    class="w-full bg-white border-2 border-primary-300 rounded-lg px-4 py-3 text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition"
                                    placeholder="Pr√©sentez-vous et expliquez pourquoi vous √™tes int√©ress√© par ce logement..."></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Votre t√©l√©phone (optionnel)</label>
                                <input type="tel" name="phone"
                                    class="w-full bg-white border-2 border-primary-300 rounded-lg px-4 py-3 text-gray-900 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition"
                                    placeholder="0694 XX XX XX">
                            </div>
                            <button type="submit"
                                class="w-full inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-bold rounded-xl shadow-medium hover:shadow-strong transition-all text-lg">
                                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                                Envoyer ma candidature
                            </button>
                        </form>
                    </div>
                    {% endif %}
                {% else %}
                <div class="bg-gray-50 border-2 border-gray-300 rounded-xl p-8 text-center">
                    <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Connectez-vous pour postuler</h3>
                    <p class="text-gray-600 mb-4">Vous devez √™tre connect√© pour postuler √† ce logement</p>
                    <a href="{% url 'login' %}?next={{ request.path }}"
                        class="inline-flex items-center justify-center px-8 py-3 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-bold rounded-xl shadow-medium hover:shadow-strong transition-all">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                        </svg>
                        Se connecter
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Similar Offers -->
        {% if similar_offers %}
        <div class="mt-12">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Offres similaires</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                {% for similar in similar_offers %}
                <a href="{% url 'housing_detail' similar.pk %}" class="glass rounded-xl overflow-hidden hover:shadow-strong transition-all border border-blue-100 hover:border-accent-300">
                    <div class="h-40 bg-gradient-to-br from-gray-100 to-blue-100">
                        {% if similar.images %}
                        <img src="{{ similar.images.url }}" class="w-full h-full object-cover" alt="{{ similar.title }}">
                        {% endif %}
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-gray-900 mb-2 truncate">{{ similar.title }}</h3>
                        <p class="text-sm text-gray-600 mb-2">üìç {{ similar.location }}</p>
                        <p class="text-lg font-bold text-primary-600">{{ similar.price }} ‚Ç¨/mois</p>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
